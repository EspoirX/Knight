# 实现原理

在了解了 Knight 的基本用法后，发现接口于实现类都是依靠注解去标记的，然后在调用 api 方法时，通过接口找到对应的实现类，并
吧实现类自动实例化。这就是框架的基本原理。如何做到的？

比如，我们有接口 IUser，IMessage，实现类 UserImpl 和 MessageImpl。那么如果有一个类将它们的关心映射下来，就很容易实现了：


```java
public interface IServiceManager {
    HashMap<String, String> getServiceImplMap();
}

public class KnightServiceManager implements IServiceManager {
    private static final HashMap<String, String> serviceImplMap = new HashMap();

    public KnightServiceManager() {
    }

    @Override
    public HashMap<String, String> getServiceImplMap() {
        return serviceImplMap;
    }

    static {
        serviceImplMap.put("com/user/service/IUser_KnightDefault", "com/user/impl/UserImpl");
        serviceImplMap.put("com/message/service/IMessage_KnightDefault", "com/message/impl/MessageImpl");
    }
}
```
如上所示，如果将接口和对应的实现类映射到一个 map 中，那么就可以根据接口在 map 中找到对应的实现类，并且调用其方法了。

Knight 的实现就是围绕着如何生成 KnightServiceManager 这个类去进行的。
